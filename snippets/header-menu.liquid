{% liquid
  assign block_settings = block.settings
  assign menu_content_type = block_settings.menu_style | default: 'text'
  assign image_border_radius = block_settings.image_border_radius
  assign color_scheme_classes = ''
  assign color_scheme_setting_id = 'color_scheme_' | append: section.settings.menu_row
  assign current_color_scheme = block_settings.color_scheme
  assign parent_color_scheme = section.settings[color_scheme_setting_id]

  if parent_color_scheme.id != current_color_scheme.id
    assign color_scheme_classes = ' color-' | append: current_color_scheme
  endif

  # Check if header and menu colors match. This is used to apply different padding styles in css
  if parent_color_scheme.settings.background.rgb == current_color_scheme.settings.background.rgb
    assign color_scheme_classes = color_scheme_classes | append: ' color-scheme-matches-parent'
  endif

  if block_settings.menu_style == 'featured_collections'
    assign ratio = block_settings.featured_collections_aspect_ratio
  elsif block_settings.menu_style == 'featured_products'
    assign ratio = block_settings.featured_products_aspect_ratio
  endif
  assign menu_links = block_settings.menu.links
  assign use_fallback_links = false
  if menu_links == blank
    assign use_fallback_links = true
  endif
  assign fallback_titles = 'Tienda|Ofertas|Nosotros' | split: '|'
  assign fallback_urls = '/collections/all|/collections/ofertas|/pages/nosotros' | split: '|'
%}

{% capture children %}
  <li
    role="presentation"
    class="menu-list__list-item menu-list__list-item--logo"
  >
    <a
      href="{{ routes.root_url }}"
      class="menu-list__link menu-list__link--logo"
      aria-label="{{ shop.name }}"
    >
      <img
        src="https://cdn.shopify.com/s/files/1/0726/2679/8780/files/Aurora_Logo_Negro_-_Website_bd1c89d0-c17f-4803-996a-062c0cc0459c.svg?v=1759104347"
        alt="{{ shop.name }}"
        class="menu-list__logo-image menu-list__logo-image--black"
        loading="lazy"
      >
    </a>
  </li>
  {% if use_fallback_links %}
    {% for title in fallback_titles %}
      {% assign fallback_url = fallback_urls[forloop.index0] %}
      {% assign link_class = 'menu-list__link' %}
      {% if title != 'Nosotros' %}
        {% assign link_class = link_class | append: ' menu-list__link--chevron' %}
      {% endif %}
      <li
        role="presentation"
        class="menu-list__list-item menu-list__list-item--fallback"
      >
        <a
          href="{{ fallback_url }}"
          class="{{ link_class }}"
          data-fallback-link="true"
        >
          <span class="menu-list__link-title">{{ title }}</span>
        </a>
      </li>
    {% endfor %}
  {% endif %}
  {% for link in block_settings.menu.links %}
    <li
      role="presentation"
      class="menu-list__list-item"
      on:focus="/activate"
      on:blur="/deactivate"
      on:pointerenter="/activate"
      on:pointerleave="/deactivate"
    >
      <a
        href="{{ link.url }}"
        data-skip-node-update="true"
        class="menu-list__link{% if link.active %} menu-list__link--active{% endif %}"
        {%- if link.links != blank -%}
          aria-controls="submenu-{{ forloop.index }}"
          aria-haspopup="true"
          aria-expanded="false"
        {%- endif -%}
        ref="menuitem"
      >
        <span class="menu-list__link-title">{{- link.title -}}</span>
      </a>
      {%- if link.links != blank -%}
        <div class="menu-list__submenu{{ color_scheme_classes }}" ref="submenu[]">
          <div
            id="submenu-{{ forloop.index }}"
            class="menu-list__submenu-inner"
            style="{% render 'submenu-font-styles', settings: block_settings %}"
          >
            {% assign list_id = 'MegaMenuList-' | append: forloop.index %}
            {% render 'mega-menu',
              section: section,
              parent_link: link,
              id: list_id,
              menu_content_type: menu_content_type,
              content_aspect_ratio: ratio,
              image_border_radius: image_border_radius
            %}
          </div>
        </div>
      {%- endif -%}
    </li>
  {% endfor %}
  <li
    class="menu-list__list-item"
    role="presentation"
    slot="more"
    on:focus="/activate"
    on:blur="/deactivate"
    on:pointerenter="/activate"
    on:pointerleave="/deactivate"
  >
    <button role="menuitem" class="button menu-list__link button-unstyled">
      <span class="menu-list__link-title">{{ 'actions.more' | t }}</span>
    </button>
  </li>
{% endcapture %}

<nav header-menu>
  <div
    class="menu-list"
    style="{% render 'menu-font-styles', settings: block_settings %}"
  >
    {% assign class = 'overflow-menu' | append: color_scheme_classes %}
    {% render 'overflow-list', class: class, ref: 'overflowMenu', children: children, minimum-items: 2, defer: true %}
  </div>
</nav>
